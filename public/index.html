<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Point Of Queue</title>
</head>

<body>

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:700,600' rel='stylesheet' type='text/css'>
    <link href='style.css' rel='stylesheet' type='text/css'>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <script src="jquery.ui.touch-punch.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script>
      $( function() {
        $('.logIn').submit(function () {
         submitCreds();
         return false;
        });
    } );
    </script>
    <br/>
    <br/>
    <br/>
    <div id="loginBox" class="box">
        <h1>Queue Login</h1>
        <input id="usernameField" autocomplete="off" autocorrect="off" autocaptitalize="off" type="name" name="name" placeholder="username" value="" class="email" />
        <label id="usernameError" class="error"></label>
        <form class="logIn" >
        <input id="passwordField" type="password" name="password" placeholder="password" value="" class="email" />
        <label id="passwordError" class="error"></label>
        </form>
        <a onclick="window.location.href='/signup'" id="signUp">
            <div class="btn">Sign Up</div>
        </a>
        <a onclick="submitCreds()" id="signIn">
            <div class="btn">Sign In</div>
        </a>
        <label id="successMsg" class="success"></label>
        <p><span style="color:#525252">Point of Queue lets you to create a Spotify(must have premium) queue, and even allows others to add songs! Perfect for car rides, parties, etc.</span></p>
    </div>

    <script>
        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function setErrors(json) {
            var usernameError = document.getElementById('usernameError');
            var passwordError = document.getElementById('passwordError');
            var successMsg = document.getElementById('successMsg');

            if (json.username) {
                $('#usernameError').text(json.username);
                $('#usernameError').css('display', 'block');
            } else {
              $('#usernameError').text('');
              $('#usernameError').css('display', 'none');
            }

            if (json.password) {
              $('#passwordError').text(json.password);
              $('#passwordError').css('display', 'block');
            } else {
              $('#passwordError').text('');
              $('#passwordError').css('display', 'none');
            }

            if (json.success) {
              $('#successMsg').text(json.success);
              $('#successMsg').css('display', 'block');
            } else {
              $('#successMsg').text('');
              $('#successMsg').css('display', 'none');
            }
        }

        function submitCreds() {
            var username = document.getElementById('usernameField').value;
            var password = document.getElementById('passwordField').value;
            $.ajax({
                type: "POST",
                url: '/',
                data: {
                    username: username,
                    password: password
                },
                dataType: 'json',
                success: function(data) {
                    console.log("Success!" + data.username);
                    setErrors({
                        "success": "Success! Logging In..."
                    });
                    window.location.replace("/room");
                },
                error: function(res, error) {
                    var result = JSON.parse(res.responseText);
                    console.log(result);
                    setErrors(result);
                }
            });
        }
    </script>
    <script>
        (function() {
            let username = getCookie('username');
            if (username != "") {
                window.location.replace("/room");
            }
        })();
    </script>
    <script>
        $(document).ready(function() {
            $('.box').hide().fadeIn(1000);
            $('#successMsg').css('display', 'none');
            $('#usernameError').css('display', 'none');
            $('#passwordError').css('display', 'none');
        });
        $('a').click(function(event) {
            event.preventDefault();
        });
    </script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <script src="jquery.ui.touch-punch.min.js"></script>
</body>

</html>
